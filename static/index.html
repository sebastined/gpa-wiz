<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPA-WIZ 🎓</title>
  <style>
    :root {
      --bg: #f5f5f5; --text: #333;
      --card: white; --btn: #0078d7; --btn-hover: #005fa3;
      --shadow: rgba(0,0,0,0.1);
      --footer-bg: #f0f0f0;
    }
    body.dark {
      --bg: #121212; --text: #eee; --card: #1e1e1e;
      --btn: #2196f3; --btn-hover: #1565c0; --shadow: rgba(255,255,255,0.1);
      --footer-bg: #1a1a1a;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg); color: var(--text);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      min-height: 100vh; margin: 0; transition: 0.3s;
      padding-bottom: 50px;
    }
    .container {
      background: var(--card); padding: 20px; border-radius: 12px;
      box-shadow: 0 0 10px var(--shadow); width: 340px;
    }
    h1 { text-align: center; margin-bottom: 10px; }
    table { width: 100%; margin-top: 10px; border-collapse: collapse; }
    th, td { padding: 6px; text-align: center; }
    button { background: var(--btn); color: white;
      border: none; padding: 6px 12px; border-radius: 5px;
      cursor: pointer; transition: background 0.3s; margin: 4px 2px; }
    button:hover { background: var(--btn-hover); }
    input, select {
      width: 90%; padding: 5px;
      border: 1px solid #ccc; border-radius: 5px;
      background: var(--bg); color: var(--text);
    }
    .theme-toggle {
      position: absolute; top: 10px; right: 10px;
      background: var(--card); border: 1px solid var(--shadow);
      border-radius: 20px; padding: 5px 10px; cursor: pointer;
    }
    #result { text-align: center; margin-top: 15px; font-weight: bold; }
    footer {
      position: fixed; bottom: 0; width: 100%;
      background: var(--footer-bg); color: var(--text);
      text-align: center; padding: 8px 0;
      font-size: 0.9em; border-top: 1px solid var(--shadow);
      transition: background 0.3s, color 0.3s;
    }
    footer a { color: var(--btn); text-decoration: none; }
  </style>
</head>
<body>
  <button id="themeToggle" class="theme-toggle">🌙 Dark</button>
  <div class="container">
    <h1>🎓 GPA-WIZ</h1>
    <table id="courseTable">
      <thead>
        <tr><th>Course</th><th>Credit</th><th>Grade</th></tr>
      </thead>
      <tbody id="courseBody">
        <tr>
          <td><input placeholder="CSC101"></td>
          <td><input type="number" min="1" value="3"></td>
          <td>
            <select><option>A</option><option>B</option>
              <option>C</option><option>D</option><option>F</option></select>
          </td>
        </tr>
      </tbody>
    </table>
    <button id="addCourse">+ Add Course</button>
    <button id="calcBtn">Calculate GPA</button>
    <div id="result">Enter your courses to begin</div>
    <button id="downloadBtn" style="display:none;">📄 Download Report</button>
  </div>

  <footer>
    © <span id="year"></span> Designed by <strong>Sebastine Nnanemere</strong> & ChatGPT
  </footer>

  <script>
    // Dark mode toggle
    const toggle = document.getElementById("themeToggle");
    const saved = localStorage.getItem("theme") || "light";
    if (saved === "dark") { document.body.classList.add("dark"); toggle.textContent = "☀️ Light"; }
    toggle.addEventListener("click", ()=> {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      toggle.textContent = isDark ? "☀️ Light" : "🌙 Dark";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });

    // Add new row
    document.getElementById("addCourse").addEventListener("click", ()=>{
      const row = document.createElement("tr");
      row.innerHTML = `<td><input placeholder="Course"></td>
        <td><input type="number" min="1" value="3"></td>
        <td><select><option>A</option><option>B</option>
          <option>C</option><option>D</option><option>F</option></select></td>`;
      document.getElementById("courseBody").appendChild(row);
    });

    // Calculate GPA
    document.getElementById("calcBtn").addEventListener("click", async ()=>{
      const rows = document.querySelectorAll("#courseBody tr");
      const courses = [];
      rows.forEach(r=>{
        const code = r.children[0].querySelector("input").value;
        const credit = r.children[1].querySelector("input").value;
        const grade = r.children[2].querySelector("select").value;
        if (code && credit) courses.push({code, credit, grade});
      });
      const res = await fetch("/api/calc_gpa", {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({courses})
      });
      const data = await res.json();
      const resultDiv = document.getElementById("result");
      if (data.error) resultDiv.textContent = "⚠️ " + data.error;
      else {
        resultDiv.textContent = `Your GPA is ${data.gpa} / ${data.scale}`;
        document.getElementById("downloadBtn").style.display = "inline-block";
        window.lastGpa = data.gpa; window.lastCourses = courses;
      }
    });

    // Download GPA report
    document.getElementById("downloadBtn").addEventListener("click", async ()=>{
      const res = await fetch("/api/download_report", {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({gpa: window.lastGpa, courses: window.lastCourses})
      });
      const data = await res.json();
      if (data.file) window.location.href = "/reports/" + data.file;
    });

    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
